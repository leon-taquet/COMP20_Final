<!--trip.html
Author: HTeamML
Comp20 Fall 2020-->

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Login</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<link rel="stylesheet" href="Stylesheet.css">
<style>
    input {
        font-family: Times New Roman;
        font-variant: none;
    }
    #addExpenseForm {
        display: none;
    }
    .errMsg {color: #FF0000;
        border: solid 1px #d20e11;
        display: none;
        padding: 1px 15px;
    }
</style>
<script language="javascript">
function showForm()
{
    document.getElementById("addExpenseForm").style.display='block';
}

function getDate()
{
    today = new Date();
    day = today.getDate();
    if (day < 10)
        day = "0" + day;
    month = today.getMonth() + 1;
    if (month < 10)
        month = "0" + month;
    fullDate = today.getFullYear() + "-" + month + "-" + day;
    return fullDate;
}

function checkDate(dateS)
{
    // Check that date entered is in valid format
    if (dateS.length != 10)
        return false;
    for (i = 0; i < 10; i++)
    {
        if (i == 4 || i == 7)
        {
            if (dateS[i] != "-")
                return false;
        }
        else if (isNaN(parseInt(dateS[i])))
            return false;
    }
    // Check that date is not in the future
    today = new Date();
    if (parseInt(dateS.substring(0,4)) > today.getFullYear())
        return false;
    else if (parseInt(dateS.substring(5,7)) > (today.getMonth()+1))
        return false;
    else if (parseInt(dateS.substring(8)) > today.getDate())
        return false;
    return true;
}

function checkAmount(amount)
{
    if (amount == "" || isNaN(parseInt(amount)))
        return false;
    else
        return true;
}

function validate()
{
    err = false;
    document.getElementById("errAmount").style.display = "none";
    document.getElementById("errDate").style.display = "none";
    with (document.forms[0])
    {
        if (!checkAmount(expenseForeign.value))
        {
            document.getElementById("errAmount").style.display = "inline-block";
            expenseForeign.focus();
            err = true;
        }
        if (!checkDate(date.value))
        {
            document.getElementById("errDate").style.display = "inline-block";
            date.focus();
            err = true;
        }
    }
    return !err;
}

function useAPI(foreign, home, date, amount)
{
    document.getElementById("amountForeign").value = parseFloat(amount).toFixed(2);
    request = new XMLHttpRequest();
    request.open("GET", "http://api.currencylayer.com/"
        + "historical?access_key=782d6f73de40f0bd7651de14e8196b0e&date=" + date
        + "&currencies=" + foreign + "," + home, true);
    request.onreadystatechange = function()
    {
        if (request.readyState == 4 && request.status == 200)
        {
            parsed = JSON.parse(request.responseText);
            conversion = (amount / parsed.quotes["USD" +
                foreign]) / parsed.quotes["USD" + home];
            document.getElementById("amountHome").value = conversion.toFixed(2);
        }
    } // end of state change function
    request.send();
}

window.onload = function()
{
    with(document.forms[0])
    {
        expenseForeign.onchange = function()
        {
            if (checkDate(date.value) && checkAmount(expenseForeign.value))
            {
                //INR is "foreign", GBP is "home"
                useAPI("INR", "GBP", date.value, expenseForeign.value);
            }
        }
        date.onchange = function()
        {
            if (checkDate(date.value) && checkAmount(expenseForeign.value))
            {
                useAPI("INR", "GBP", date.value, expenseForeign.value);
            }
        }
    }
}
</script>
</head>

<body>
<header><a class="header" href="login.html">International Travel Expense Tracker</a></header>
<nav>
    <ul>
        <div class="leftnav">
            <li><a href = "about.html">About</a></li>
            <li><a href = #>Dashboard</a></li>
            <div class="rightnav">
                <li><a href = #><span class="glyphicon glyphicon-log-out"></span> Logout</a> </li>
            </div>
        </div>
    </ul>
</nav>
<h1>My Trip</h1>
<button type="button" id="addexpense" onclick="showForm()">Add Expense</button>
<div id="addExpenseForm">
    <form method="post" onsubmit="return validate()" action="newExpense.php">
        Expense Name: <input type="text" id="expenseName" name="expenseN" value="">
        <br>
        Type: <input type="text" id="expenseType" name="expenseT" value="">
        <br>
        Amount in Foreign Currency: <input type="text" id="amountForeign" name="expenseForeign" value="">
        <div id="errAmount" class="errMsg">Please input a numerical expense amount.</div>
        <br>
        <script type="text/javascript">
            code = "Date: <input type='text'id='expenseDate'name='date'value='" + getDate() + "'>"
            document.writeln(code);
        </script>
        <div id="errDate" class="errMsg">Please input a valid date in the form YYYY-MM-DD.</div>
        <br>
        Amount in Home Currency: <input type="text" id="amountHome" name="expenseHome">
        <br>
        <input type="submit" value="Submit Expense">
    </form>
</div>
<footer>ITET</footer>

</body>
